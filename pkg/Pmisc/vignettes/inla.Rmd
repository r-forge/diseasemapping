<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{INLA examples}
-->

```{r inlaWorkaround, include=FALSE}
# use the static INLA on linux machines
# to avoid possible 'libgomp not found' errors
if(Sys.info()['sysname'] =='Linux' &
  requireNamespace("INLA")) {   
  INLA::inla.setOption(inla.call = 
      system.file(paste(
          "bin/linux/",          
          ifelse(
            .Machine$sizeof.pointer == 4, 
            "32", "64"),
          'bit/inla.static', sep=''),
        package="INLA")) 
}
```


# Weibull With Cure Fraction

the data
```{r kidneyData, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
data(Kidney, package='INLA')
head(Kidney)
```

scale the response variable
```{r scale, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
Kidney$years = Kidney$time / 365.25
```




run the model 

```{r fitInla, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
library("INLA")
mod = inla(
  inla.surv(years, event) ~ age * sex + 
    f(ID, model="iid", prior='pc.prec', param=c(0.5, 0.1)), 
  family="weibullcure", 
  control.family = list(hyper=list(
      'log alpha' = list(
        prior='loggamma', param=c(1,1)),
      'logit probability' = list(
        prior='logitbeta', param=c(1,1))
    )),
  data=Kidney, 
  control.inla=list(h=0.001), 
  control.mode = list(theta=c(0,-5,4), restart=TRUE),
  verbose=TRUE)
```

results

```{r results, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
knitr::kable(mod$summary.fixed, digits=3)
knitr::kable(mod$summary.hyper, digits=3)
```

standard deviation
```{r sdSummary, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
modSd = Pmisc::priorPost(mod)
knitr::kable(modSd$summary, digits=2)
```

```{r sdPlot, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
do.call(matplot, modSd$sd$matplot)
do.call(legend, modSd$legend)
```

```{r alphaPlot, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
do.call(matplot, modSd$alpha$matplot)
do.call(legend, modSd$legend)
```

```{r probPlot, eval = requireNamespace("INLA"), purl= requireNamespace("INLA")}
do.call(matplot, modSd$prob$matplot)
do.call(legend, modSd$legend)
```

