<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{backsolveBatch}
-->


```{r setup, include=FALSE}
library('gpuR')
```


## backsolve function test
```{r  ABC}
A1 = matrix( c(3,1, 2,0,0, 0, 1,11, 0, 0, 0,1, 2,3,5,1), nrow=4, ncol=4, byrow = TRUE) 
A2 = matrix( c(1, 1, 3,0,0,0, 1, 12, 0,0, 0, 1, 0, 0, 0, 0), nrow=4, ncol=4, byrow = TRUE) 
a1 = matrix( c(1, 2,0,0, 1,11, 0, 0, 1), nrow=3, ncol=3, byrow = TRUE) 
a2 = matrix( c(1, 3,0,0, 1,12, 0, 0, 1), nrow=3, ncol=3, byrow = TRUE) 

C1 = matrix( c(2, 4, 3, 1, 5, 7), nrow=3, ncol=2, byrow=F) 
C2 = matrix( c(1, 5, 30, 12, 2, 17), nrow=3, ncol=2,byrow=F)  

B1 = a1%*%C1
B2= a2%*%C2
BN1 <- matrix( c(0,0,0,0, 0, 10, 11,5, 30,37,82,0, 1,3,7, 0,0,0 , 2, 17), nrow=5, ncol=4, byrow=T)  
BN1
BN2 <- matrix( c(0,0,0,0, 0, 16, 18,5, 30,365,206,0, 1,30,17, 6,0,0 , 2, 17), nrow=5, ncol=4, byrow=T)  
BN2
A <- rbind(A1,A2)
A
B <- rbind(BN1,BN2)
B
C <- rbind(C1,C2)
C
gpuA <- vclMatrix(A, type="double")
gpuB <- vclMatrix(B, type="double")
gpuC <- vclMatrix(0,nrow=6, ncol=3, type="double")
```

## test

```{r backsolve}
NlocalCache = 0
Nglobal = c(8L, 8L, 8L)
Nlocal = c(4L, 2L)
gpuRandom:::backsolveBatchBackend(gpuC, gpuA, gpuB, 
                                  c(0,2,0,1),c(0,2,1,3),c(1,3,1,2),2L,
                                  diagIsOne=T, Nglobal, Nlocal, NlocalCache)
as.matrix(gpuC)

```

