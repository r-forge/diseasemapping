# Try to detect MKL installation path
MKLROOT := $(shell echo $$MKLROOT)
ifeq ($(MKLROOT),)
# MKLROOT env var not set; try default install path
MKLROOT := /opt/intel/oneapi/mkl/latest
endif

MKL_LIB := $(MKLROOT)/lib/intel64/libmkl_rt.so
MKL_INC := $(MKLROOT)/include

# Check if MKL library exists
ifneq ("$(wildcard $(MKL_LIB))","")
  USE_MKL = 1
else
  USE_MKL = 0
endif

ifeq ($(USE_MKL),1)
  PKG_CPPFLAGS = -I$(MKL_INC)
  PKG_LIBS = -L$(MKLROOT)/lib/intel64 -lmkl_rt -lpthread -lm -ldl
else
  PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)
endif

all: $(SHLIB)
